# üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–´ –ü–ê–ú–Ø–¢–ò

## üö® –¢–ï–ö–£–©–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `HybridMemory` (EnhancedBufferMemory + VectorMemory)
- `MemoryLevelsManager` (ShortMemory + IntelligentVectorMemory)
- `MemoryAdapter` –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ
- **–†–ï–ó–£–õ–¨–¢–ê–¢:** –°–∏—Å—Ç–µ–º—ã –Ω–µ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ, –¥—É–±–ª–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å –ù–ï –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ N —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–∏—Å—Ç–µ–º–∞ –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ø–∞–º—è—Ç—å
- **–†–ï–ó–£–õ–¨–¢–ê–¢:** –ü–æ—Å–ª–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ä—ã–º –¥–∞–Ω–Ω—ã–º

### 3. MemoryAdapter –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ù–µ –∑–Ω–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏
- –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å
- **–†–ï–ó–£–õ–¨–¢–ê–¢:** –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏

## ‚úÖ –†–ï–®–ï–ù–ò–ï: –£–ü–†–û–©–ï–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:
```
UnifiedMemoryManager
‚îú‚îÄ‚îÄ ShortTermWindow (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
‚îú‚îÄ‚îÄ VectorDatabase (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è > 10)
‚îî‚îÄ‚îÄ SmartRetriever (–≤—ã–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)
```

### –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´:
1. **–°–æ–æ–±—â–µ–Ω–∏—è 1-10:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ShortTermWindow
2. **–°–æ–æ–±—â–µ–Ω–∏—è 11+:** 
   - –°–æ–æ–±—â–µ–Ω–∏—è 1-10 –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ VectorDatabase
   - ShortTermWindow —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10
   - SmartRetriever –∏—â–µ—Ç –≤ VectorDatabase –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
- ‚úÖ –û–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ –≤–º–µ—Å—Ç–æ 4-—Ö
- ‚úÖ –ß–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## üõ†Ô∏è –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å UnifiedMemoryManager
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º –ø–∞–º—è—Ç–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ç–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ short ‚Üí vector
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–æ–º –ø–∞–º—è—Ç–∏

### –®–∞–≥ 2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å MemoryAdapter
- –£–±—Ä–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É "—É–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞" –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
- –¢–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìã –ö–û–ù–ö–†–ï–¢–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. app/memory/unified_memory.py (–ù–û–í–´–ô)
```python
class UnifiedMemoryManager:
    def __init__(self, user_id: str, window_size: int = 10):
        self.user_id = user_id
        self.window_size = window_size
        self.short_term_messages = []  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π
        self.vector_db = IntelligentVectorMemory(user_id)
        self.message_count = 0
    
    def add_message(self, message):
        self.message_count += 1
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–∫–Ω–æ
        self.short_term_messages.append(message)
        
        # –ï—Å–ª–∏ –æ–∫–Ω–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ - –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
        if len(self.short_term_messages) > self.window_size:
            oldest_message = self.short_term_messages.pop(0)
            self.vector_db.add_document(oldest_message)
    
    def get_context_for_prompt(self, query: str):
        # –õ–û–ì–ò–ö–ê –í–´–ë–û–†–ê –ò–°–¢–û–ß–ù–ò–ö–ê:
        if self.message_count <= self.window_size:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å
            return self._format_short_term_context()
        else:
            # –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º: –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è + –ø–æ–∏—Å–∫ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
            short_context = self._format_short_term_context()
            vector_context = self.vector_db.search(query, max_results=5)
            return self._combine_contexts(short_context, vector_context)
```

### 2. app/memory/memory_adapter.py (–£–ü–†–û–©–ï–ù–ò–ï)
```python
class MemoryAdapter:
    def __init__(self, user_id: str):
        self.unified_memory = UnifiedMemoryManager(user_id)
    
    def get_for_prompt(self, user_id: str, query: str):
        # –ü–†–û–°–¢–ê–Ø –õ–û–ì–ò–ö–ê - –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
        context = self.unified_memory.get_context_for_prompt(query)
        
        return {
            "short_memory_summary": context.get("recent", "‚Äî"),
            "long_memory_facts": context.get("facts", "‚Äî"),
            "semantic_context": context.get("search_results", "‚Äî")
        }
```

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–∏—Å—Ç–µ–º
- –£–¥–∞–ª–∏—Ç—å HybridMemory (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ UnifiedMemoryManager)
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å MemoryLevelsManager –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å UnifiedMemoryManager
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö: UnifiedMemoryManager ‚Üí MemoryAdapter ‚Üí Prompt

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–º–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ 10+ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ß–µ—Ç–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å
- ‚úÖ –ò–ò –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–∏—Å—Ç–µ–º—ã

## üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –° –ö–†–ò–¢–ò–ß–ï–°–ö–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –∏—Å–ø—Ä–∞–≤–∏–º MemoryAdapter, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–ª –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
