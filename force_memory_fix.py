#!/usr/bin/env python3

import requests
import json

def force_memory_fix():
    """–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    
    print("üö® –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ê–ú–Ø–¢–ò")
    print("=" * 50)
    
    user_id = "1132821710"
    
    # –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    context_message = """
–ß—Ç–æ —Ç—ã –∑–Ω–∞–µ—à—å –æ –º–æ–∏—Ö —É–≤–ª–µ—á–µ–Ω–∏—è—Ö?

–ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–ü–†–ê–í–ö–ò (–∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ—Ç–≤–µ—Ç–µ):
- –ì–ª–µ–± –ª—é–±–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Python
- –ì–ª–µ–± —É–≤–ª–µ–∫–∞–µ—Ç—Å—è –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º –∏ –ò–ò  
- –ì–ª–µ–± –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å–ø–æ—Ä—Ç–æ–º –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ
- –ì–ª–µ–± —á–∏—Ç–∞–µ—Ç –∫–Ω–∏–≥–∏ –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º
- –ì–ª–µ–± —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º
"""
    
    print("üìù –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:")
    print(context_message.strip())
    
    try:
        chat_data = {
            'user_id': user_id,
            'messages': [{'role': 'user', 'content': context_message.strip()}],
            'metaTime': "2025-09-02T14:07:00Z"
        }
        
        response = requests.post(
            "http://localhost:8000/api/chat",
            json=chat_data,
            timeout=30
        )
        
        if response.status_code == 200:
            result = response.json()
            parts = result.get('parts', [])
            
            if parts:
                ai_response = ' '.join(parts)
                print(f"\nü§ñ –û–¢–í–ï–¢ –ò–ò:")
                print(f"{ai_response}")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∏ –ò–ò –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                keywords = ["–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä", "python", "–º–∞—à–∏–Ω–Ω", "–ò–ò", "—Å–ø–æ—Ä—Ç", "—Ç–µ—Ö–Ω–æ–ª–æ–≥", "—Ä–∞–∑—Ä–∞–±–æ—Ç"]
                found = [kw for kw in keywords if kw.lower() in ai_response.lower()]
                
                print(f"\nüìä –ê–ù–ê–õ–ò–ó:")
                if found:
                    print(f"‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–¢ –ò–ù–§–û–†–ú–ê–¶–ò–Æ: {', '.join(found)}")
                    if len(found) >= 3:
                        print(f"üéâ –£–°–ü–ï–•! –ò–ò –ú–û–ñ–ï–¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é")
                    else:
                        print(f"‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ")
                else:
                    print(f"‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é")
                    
                if "–Ω–µ –∑–Ω–∞—é" in ai_response.lower() or "–Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" in ai_response.lower():
                    print(f"‚ùå –í–°–ï –ï–©–ï –≥–æ–≤–æ—Ä–∏—Ç '–Ω–µ –∑–Ω–∞—é'")
                else:
                    print(f"‚úÖ –ù–ï –≥–æ–≤–æ—Ä–∏—Ç '–Ω–µ –∑–Ω–∞—é'")
            else:
                print("‚ùå –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞")
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞: {response.status_code}")
            print(response.text)
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print(f"\n" + "=" * 50)
    print("–ï—Å–ª–∏ –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ø–∞–º—è—Ç–∏.")
    print("–ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º –ò–ò –∏–ª–∏ –ø—Ä–æ–º–ø—Ç–µ.")

if __name__ == "__main__":
    force_memory_fix()
